{"version":3,"sources":["webpack:///./src/views/City.vue?1f05","webpack:///./src/components/LayerSelector.vue?d56f","webpack:///./src/map/layer/fengxianquLayer.js","webpack:///src/components/LayerSelector.vue","webpack:///./src/components/LayerSelector.vue?3b3a","webpack:///./src/components/LayerSelector.vue","webpack:///src/views/City.vue","webpack:///./src/views/City.vue?01d7","webpack:///./src/views/City.vue","webpack:///./src/components/LayerSelector.vue?fa59","webpack:///./src/views/City.vue?60c5"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","model","value","callback","$$v","input","expression","on","$event","showLayerSwith","slot","directives","name","rawName","_e","staticRenderFns","_l","item","i","key","layerGroupChange","class","active","checked","_v","_s","label","sub","j","stopPropagation","layerChange","colorMap","1","2","3","FengxianquLayer","data","_loadData","options","showAnimaion","_flashLayer","_createFlashLayer","source","getSource","e","_flash","feature","_startAnimation","geomType","getGeometry","getType","color","get","_createPointStyle","size","fillColor","strokeColor","strokeWidth","Style","fill","Fill","style","width","option","image","Circle","radius","stroke","Stroke","VectorLayer","VectorSource","mapObj","getOlMap","addLayer","features","oLayer","getFeatures","pointsFeature","forEach","geom","getInteriorPoint","point","pt","Feature","geometry","setProperties","time","push","length","index","timer","setInterval","clearInterval","addFeature","map","start","Date","now","duration","clone","animate","event","frameState","elapsed","elapsedRatio","easeOut","opacity","setStyle","BaseLayer","layers","children","layerOption","type","dataSource","api","inject","mounted","init","methods","layerList","Object","prototype","hasOwnProperty","call","createLayer","layerName","fxqLayer","LayerC","styleFunc","layer","undefined","loadData","getStyle","styleName","anchor","src","zfjcd","createIconStyle","icon","mfjcd","fxq","styles","component","components","LayerSelector","provide","getMap","self","target","center","zoom"],"mappings":"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","file":"assets/js/city.64413d0e.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{attrs:{\"id\":\"map\"}},[(_vm.mapObj)?_c('div',{staticClass:\"top\"},[_c('el-input',{attrs:{\"placeholder\":\"请输入内容\"},model:{value:(_vm.input),callback:function ($$v) {_vm.input=$$v},expression:\"input\"}},[_c('el-button',{attrs:{\"slot\":\"prepend\",\"icon\":\"el-icon-menu\"},on:{\"click\":function($event){_vm.showLayerSwith=!_vm.showLayerSwith}},slot:\"prepend\"})],1),_c('LayerSelector',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showLayerSwith),expression:\"showLayerSwith\"}],staticClass:\"layer\"})],1):_vm._e(),_c('div',{staticClass:\"bottom\"},[_c('div',{staticClass:\"sos\"},[_c('el-button',{attrs:{\"icon\":\"el-icon-search\",\"circle\":\"\"}})],1)])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"layer_warp\"},_vm._l((_vm.layers),function(item,i){return _c('div',{key:i,staticClass:\"item\",on:{\"click\":function($event){return _vm.layerGroupChange(item)}}},[_c('span',{class:{active: item.checked}},[_vm._v(_vm._s(item.label))]),_vm._l((item.children),function(sub,j){return _c('div',{key:j,staticClass:\"sub-item\",class:{active: sub.checked},on:{\"click\":function($event){$event.stopPropagation();return _vm.layerChange(sub)}}},[_vm._v(\" \"+_vm._s(sub.label)+\" \")])})],2)}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import BaseLayer from './baseLayer'\r\nimport { Style, Fill, Stroke, Circle, RegularShape } from 'ol/style'\r\nimport VectorLayer from 'ol/layer/Vector'\r\nimport VectorSource from 'ol/source/Vector'\r\nimport { Feature } from 'ol'\r\nimport Point from 'ol/geom/Point'\r\nimport { getVectorContext } from 'ol/render'\r\nimport { unByKey } from 'ol/Observable'\r\nimport { easeOut } from 'ol/easing'\r\n\r\nconst colorMap = {\r\n  1: '#bd2130', // 红\r\n  2: '#ffc107', // 黄\r\n  3: '#2461a3' // 蓝\r\n}\r\nclass FengxianquLayer extends BaseLayer {\r\n  _flashLayer = null\r\n  setData (data) {\r\n    this._loadData(data)\r\n\r\n    if (this.options.showAnimaion) {\r\n      if (!this._flashLayer) {\r\n        this._createFlashLayer()\r\n        const source = this._flashLayer.getSource()\r\n        source.on('addfeature', (e) => {\r\n          this._flash(e.feature)\r\n        })\r\n      }\r\n      this._startAnimation()\r\n    }\r\n  }\r\n\r\n  _styleFunc (feature) {\r\n    const geomType = feature.getGeometry().getType()\r\n    const color = colorMap[feature.get('level') || 3]\r\n    if (geomType === 'Point') {\r\n      return this._createPointStyle({\r\n        size: 5,\r\n        fillColor: color,\r\n        strokeColor: '#ccc',\r\n        strokeWidth: 1\r\n      })\r\n    } else if (geomType === 'Polygon') {\r\n      return new Style({\r\n        fill: new Fill({\r\n          color: color\r\n        }),\r\n        style: new Style({\r\n          color: '#ccc',\r\n          width: 2\r\n        })\r\n      })\r\n    }\r\n  }\r\n\r\n  _createPointStyle (option) {\r\n    return new Style({\r\n      image: new Circle({\r\n        radius: option.size,\r\n        fill: new Fill({\r\n          color: option.fillColor\r\n        }),\r\n        stroke: new Stroke({\r\n          color: option.strokeColor,\r\n          width: option.strokeWidth\r\n        })\r\n      })\r\n    })\r\n  }\r\n\r\n  _createFlashLayer () {\r\n    this._flashLayer = new VectorLayer({\r\n      source: new VectorSource(),\r\n      // style () {\r\n      //   return new Style({\r\n      //     image: new Circle({\r\n      //       radius: 20,\r\n      //       stroke: new Stroke({\r\n      //         color: 'red',\r\n      //         width: 1\r\n      //       })\r\n      //     })\r\n      //   })\r\n      // }\r\n    })\r\n    this.mapObj.getOlMap().addLayer(this._flashLayer)\r\n  }\r\n\r\n  _startAnimation () {\r\n    const features = this.oLayer.getSource().getFeatures()\r\n    const pointsFeature = []\r\n    features.forEach((item) => {\r\n      const geom = item.getGeometry()\r\n      if (geom.getInteriorPoint) {\r\n        const point = geom.getInteriorPoint()\r\n        const pt = new Feature({\r\n          geometry: point\r\n        })\r\n        pt.setProperties({\r\n          time: 0\r\n        })\r\n        pointsFeature.push(pt)\r\n      }\r\n    })\r\n\r\n    if (pointsFeature.length === 0) {\r\n      return\r\n    }\r\n    const source = this._flashLayer.getSource()\r\n    let index = 0\r\n    const timer = setInterval(() => {\r\n      if (index === pointsFeature.length) {\r\n        clearInterval(timer)\r\n      } else {\r\n        source.addFeature(pointsFeature[index])\r\n        index++\r\n      }\r\n    }, 1000)\r\n  }\r\n\r\n  _flash (feature) {\r\n    const map = this.mapObj.getOlMap()\r\n    let start = Date.now()\r\n    const flashGeom = feature.getGeometry().clone()\r\n    const listenerKey = map.on('postrender', animate)\r\n\r\n    const duration = 30000\r\n    function animate (event) {\r\n      const frameState = event.frameState\r\n      const elapsed = frameState.time - start\r\n      if (elapsed >= duration) {\r\n        // unByKey(listenerKey)\r\n        start += duration\r\n        return\r\n      }\r\n      // const vectorContext = getVectorContext(event)\r\n      const elapsedRatio = elapsed / duration\r\n      // radius will be 5 at start and 30 at end.\r\n      const radius = easeOut(elapsedRatio) * 25 + 5\r\n      const opacity = easeOut(1 - elapsedRatio)\r\n\r\n      const style = new Style({\r\n        image: new Circle({\r\n          radius: radius,\r\n          stroke: new Stroke({\r\n            color: 'rgba(255, 0, 0, ' + opacity + ')',\r\n            width: 0.25 + opacity\r\n          })\r\n        })\r\n      })\r\n\r\n      feature.setStyle(style)\r\n      // feature.drawGeometry(flashGeom)\r\n      // tell OpenLayers to continue postrender animation\r\n      map.render()\r\n    }\r\n  }\r\n}\r\n\r\nexport default FengxianquLayer\r\n","<template>\r\n  <div class=\"layer_warp\">\r\n    <div v-for=\"(item, i) in layers\"\r\n      :key=\"i\"\r\n      class=\"item\"\r\n      @click=\"layerGroupChange(item)\">\r\n      <span :class=\"{active: item.checked}\">{{item.label}}</span>\r\n      <div\r\n        v-for=\"(sub, j) in item.children\"\r\n        :key=\"j\"\r\n        :class=\"{active: sub.checked}\"\r\n        @click.stop=\"layerChange(sub)\"\r\n        class=\"sub-item\">\r\n        {{sub.label}}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport PointLayer from '../map/layer/pointLayer'\r\nimport FengxianquLayer from '../map/layer/fengxianquLayer'\r\nimport mapUtil from '../utils/mapUtil'\r\nimport { Style, Fill, Stroke, Circle, Icon, RegularShape } from 'ol/style'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      layers: [\r\n        {\r\n          name: 'hsjcd',\r\n          label: '核酸检测点',\r\n          checked: false,\r\n          children: [\r\n            {\r\n              name: 'zfjcd',\r\n              label: '自费检测点',\r\n              checked: true,\r\n              layerOption: {\r\n                type: 'point', // 对应图层类\r\n                dataSource: {\r\n                  api: 'getZfStation'\r\n                },\r\n                style: 'zfjcd' // 样式名\r\n              }\r\n            },\r\n            {\r\n              name: 'mfjcd',\r\n              label: '免费检测点',\r\n              checked: false,\r\n              layerOption: {\r\n                type: 'point',\r\n                dataSource: {\r\n                  api: 'getFreeCheckPoint',\r\n                  type: 'pointList'\r\n                },\r\n                style: 'mfjcd' // 样式名\r\n              }\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          name: 'ymjzd',\r\n          label: '疫苗接种点',\r\n          checked: false,\r\n          layerOption: {\r\n            type: 'point',\r\n            dataSource: {\r\n              api: 'getStation'\r\n            },\r\n            style: 'point' // 样式名\r\n          }\r\n        },\r\n        {\r\n          name: 'fyq',\r\n          label: '风险区',\r\n          checked: false,\r\n          children: [\r\n            {\r\n              name: 'gfxq',\r\n              label: '高风险区',\r\n              checked: false,\r\n              layerOption: {\r\n                type: 'fxqLayer',\r\n                showAnimaion: true,\r\n                dataSource: {\r\n                  api: ''\r\n                },\r\n                style: 'fxq' // 样式名\r\n              }\r\n            },\r\n            {\r\n              name: 'gfxq',\r\n              label: '中风险区',\r\n              checked: false,\r\n              layerOption: {\r\n                type: 'fxqLayer',\r\n                showAnimaion: true,\r\n                dataSource: {\r\n                  api: 'getFxq'\r\n                }\r\n              }\r\n            },\r\n            {\r\n              name: 'gfxq',\r\n              label: '低风险区',\r\n              checked: false,\r\n              layerOption: {\r\n                type: 'fxqLayer',\r\n                showAnimaion: true,\r\n                dataSource: {\r\n                  api: 'getStation'\r\n                },\r\n                style: 'fxq' // 样式名\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  inject: ['getMap'],\r\n  mounted () {\r\n    this.init()\r\n  },\r\n  methods: {\r\n    init () {\r\n      let layerList = []\r\n      this.layers.forEach((item) => {\r\n        layerList.push(item)\r\n        if (item.children) {\r\n          layerList = layerList.concat(item.children)\r\n        }\r\n      })\r\n\r\n      layerList.forEach((item) => {\r\n        if (Object.prototype.hasOwnProperty.call(item, 'layerOption')) {\r\n          if (item.checked && item.layerOption) {\r\n            const layer = this.createLayer(item.layerOption, item.name)\r\n            item.layer = layer\r\n            if (item.layerOption.dataSource) {\r\n              this.loadData(item.layerOption.dataSource, layer)\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n    createLayer (option, layerName) {\r\n      const layerClassList = {\r\n        point: PointLayer,\r\n        fxqLayer: FengxianquLayer\r\n      }\r\n\r\n      const mapObj = this.getMap()\r\n\r\n      const LayerC = layerClassList[option.type]\r\n      if (LayerC) {\r\n        const layer = new LayerC({\r\n          mapObj: mapObj,\r\n          name: layerName,\r\n          styleFunc: option.style ? this.getStyle(option.style) : undefined,\r\n          showAnimaion: option.showAnimaion\r\n        })\r\n        return layer\r\n      }\r\n      return null\r\n    },\r\n    layerGroupChange (data) {\r\n      data.checked = !data.checked\r\n      if (data.children) {\r\n        data.children.forEach((item) => {\r\n          this.layerChange(item, data.checked)\r\n        })\r\n      }\r\n    },\r\n    layerChange (data, checked) {\r\n      if (checked !== undefined) {\r\n        data.checked = checked\r\n      } else {\r\n        data.checked = !data.checked\r\n      }\r\n      if (data.layer) {\r\n        data.layer.setVisible(data.checked)\r\n      } else {\r\n        if (data.checked) {\r\n          data.layer = this.createLayer(data.layerOption, data.name)\r\n          this.loadData(data.layerOption.dataSource, data.layer)\r\n        }\r\n      }\r\n    },\r\n    loadData (source, layer) {\r\n      if (source.api && layer) {\r\n        const api = this.$api[source.api]\r\n        if (api) {\r\n          api().then((res) => {\r\n            let data\r\n            if (source.type === 'pointList') {\r\n              data = mapUtil.dataListToPointsFeature(res, 'longitude', 'latitude')\r\n            } else {\r\n              data = mapUtil.readGeoJSON(res.data)\r\n            }\r\n            layer.setData(data)\r\n          })\r\n        }\r\n      }\r\n    },\r\n\r\n    getStyle (styleName) {\r\n      const createIconStyle = (icon) => {\r\n        const style = new Style({\r\n          image: new Icon({\r\n            anchor: [0.5, 0.5],\r\n            src: icon\r\n          })\r\n        })\r\n        return style\r\n      }\r\n      const styles = {\r\n        point: function (ft) {\r\n          return new Style({\r\n            image: new Circle({\r\n              radius: 5,\r\n              fill: new Fill({\r\n                color: '#fff'\r\n              })\r\n            })\r\n          })\r\n        },\r\n        zfjcd: function (ft) {\r\n          const icon = './image/pa_f.png'\r\n          return createIconStyle(icon)\r\n        },\r\n        mfjcd: function (ft) {\r\n          const icon = './image/checkpoint_open.png'\r\n          return createIconStyle(icon)\r\n        },\r\n        fxq: function (ft) {\r\n          const level = ft.get('level')\r\n          const colorMap = {\r\n            1: 'red',\r\n            2: '#e3ef2e',\r\n            3: '#8f8080'\r\n          }\r\n          return new Style({\r\n            fill: new Fill({\r\n              color: colorMap[level] || '#8f8080'\r\n            }),\r\n            style: new Style({\r\n              color: '#ccc',\r\n              width: 2\r\n            })\r\n          })\r\n        }\r\n      }\r\n      if (styles[styleName]) {\r\n        return styles[styleName]\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .layer_warp{\r\n    background: #67676cb3;\r\n    .item{\r\n      cursor: pointer;\r\n      text-align: left;\r\n      .sub-item{\r\n        padding-left: 2rem;\r\n        margin: 0.5rem;\r\n        text-align: left;\r\n      }\r\n    }\r\n    .active{\r\n      color: blue;\r\n    }\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LayerSelector.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LayerSelector.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./LayerSelector.vue?vue&type=template&id=6502c6f0&scoped=true&\"\nimport script from \"./LayerSelector.vue?vue&type=script&lang=js&\"\nexport * from \"./LayerSelector.vue?vue&type=script&lang=js&\"\nimport style0 from \"./LayerSelector.vue?vue&type=style&index=0&id=6502c6f0&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6502c6f0\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <div>\r\n    <div id=\"map\">\r\n      <div class=\"top\" v-if=\"mapObj\">\r\n        <el-input placeholder=\"请输入内容\" v-model=\"input\">\r\n          <el-button slot=\"prepend\" icon=\"el-icon-menu\" @click=\"showLayerSwith=!showLayerSwith\"></el-button>\r\n        </el-input>\r\n        <LayerSelector\r\n          v-show=\"showLayerSwith\"\r\n          class=\"layer\"></LayerSelector>\r\n      </div>\r\n      <div class=\"bottom\">\r\n        <div class=\"sos\">\r\n          <el-button icon=\"el-icon-search\" circle></el-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport LayerSelector from 'comps/LayerSelector.vue'\r\nimport AMap from '../map/aMap'\r\nexport default {\r\n  data () {\r\n    return {\r\n      mapObj: null,\r\n      input: '',\r\n      showLayerSwith: false\r\n    }\r\n  },\r\n  components: {\r\n    LayerSelector\r\n  },\r\n  provide () {\r\n    const self = this\r\n    return {\r\n      getMap () {\r\n        return self.mapObj\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    this.init()\r\n  },\r\n  methods: {\r\n    init () {\r\n      this.mapObj = new AMap({\r\n        target: 'map',\r\n        center: [114.21923, 22.717446],\r\n        zoom: 16\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  @import url('~ol/ol.css');\r\n  #map{\r\n    height: 100vh;\r\n    width: 100%;\r\n    position: absoulte;\r\n  }\r\n  .top{\r\n    position: absolute;\r\n    top: 1rem;\r\n    left: 1rem;\r\n    width: 50%;\r\n    z-index: 100;\r\n    .layer{\r\n      position: absolute;\r\n      left: 0;\r\n      z-index: 100;\r\n    }\r\n  }\r\n  .bottom{\r\n    position: absolute;\r\n    bottom: 1rem;\r\n    text-align: center;\r\n    z-index: 100;\r\n  }\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./City.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./City.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./City.vue?vue&type=template&id=67e26b28&scoped=true&\"\nimport script from \"./City.vue?vue&type=script&lang=js&\"\nexport * from \"./City.vue?vue&type=script&lang=js&\"\nimport style0 from \"./City.vue?vue&type=style&index=0&id=67e26b28&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"67e26b28\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LayerSelector.vue?vue&type=style&index=0&id=6502c6f0&lang=less&scoped=true&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./City.vue?vue&type=style&index=0&id=67e26b28&lang=less&scoped=true&\""],"sourceRoot":""}