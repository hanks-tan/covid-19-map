(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-389ced62"],{"209d":function(t,a,e){"use strict";e.r(a);var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"container"},[e("div",{staticClass:"search_wrap"},[e("el-input",{staticClass:"input-with-select",attrs:{clearable:!0,placeholder:"请输入日期或者地址"},on:{change:t.searchHandle,clear:function(a){t.showSearchResult=!1}},model:{value:t.input,callback:function(a){t.input=a},expression:"input"}},[e("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.searchHandle},slot:"append"})],1),e("Info",{directives:[{name:"show",rawName:"v-show",value:t.showSearchResult,expression:"showSearchResult"}],staticClass:"search_result",attrs:{data:t.searchResult}})],1),e("div",{staticClass:"layer_wrap"},[e("div",{staticClass:"selector_wrap"},[e("div",{staticClass:"layer_item",class:{disabled:t.showTimeLine},on:{click:t.changeTotalType}},[t._v(t._s(t.totalType.label))]),e("div",{staticClass:"layer_item",class:{disabled:t.showTimeLine},on:{click:function(a){return t.showChartHandle(0)}}},[t._v("分布图")]),e("div",{staticClass:"layer_item",class:{disabled:t.showTimeLine},on:{click:function(a){return t.showChartHandle(1)}}},[t._v("趋势图")]),e("div",{staticClass:"layer_item last_item",on:{click:t.showTimeLineHandle}},[t._v("时间轴")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:"custom"===t.totalType.code,expression:"totalType.code === 'custom'"}],staticClass:"date_picker"},[e("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small"},on:{change:t.dataRangeChanged},model:{value:t.dateRange,callback:function(a){t.dateRange=a},expression:"dateRange"}})],1)]),e("Map",{ref:"map",attrs:{center:t.mapCenter}}),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.showTimeLine,expression:"!showTimeLine"}],staticClass:"chart_wrap"},[e("transition",{attrs:{name:"chart",mode:"out-in"}},["distributionChart"===t.showChart?e("DistributionChart",{attrs:{data:t.szyqData}}):"trendChart"===t.showChart?e("TrendChart",{attrs:{data:t.szyqData}}):t._e()],1)],1),t.showTimeLine?e("TimeLine",{staticClass:"timeline-container",attrs:{startDate:"2022-03-01",speed:1},on:{changeDate:t.handleDateChange}}):t._e(),e("div",{staticClass:"datainfo",class:{move:t.showTimeLine}},[t._v(" 数据时间范围："+t._s(t.covidDataDate.start)+" "),e("span",[t._v("至")]),t._v(" "+t._s(t.covidDataDate.end)+" ")])],1)},i=[],s=e("3835"),r=(e("d3b7"),e("3ca3"),e("ddb0"),e("d81d"),e("4de4"),e("ac1f"),e("5319"),e("c1df")),o=e.n(r),c=e("a0be"),l=e("4787"),u=e("5831"),h=e("4cdf"),d=e("f403"),p=e("343d"),f=e("333f"),v=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[t.count>0?[e("div",{staticClass:"collapse-item__header",class:{active:t.showDetail},on:{click:t.showDetailsHandle}},[t._v(" "+t._s(t.date)+" 新增病例 "+t._s(t.count)+" 例 "),e("i",{staticClass:"el-icon-arrow-right collapse-item__arrow",class:{active:t.showDetail}})]),t.showDetail?e("Details",{attrs:{data:t.data}}):t._e()]:[e("div",[t._v("暂时数据")])]],2)},m=[],w=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",{staticClass:"title"},[t._v("数据分布占比")]),t._l(t.groupList,(function(a,n){return e("div",{key:n,staticClass:"group-item"},[e("div",{staticClass:"item-label"},[t._v(t._s(a.prop))]),e("div",{staticClass:"line-bar"},[t._l(a.group,(function(a,n){return[e("el-tooltip",{key:n,attrs:{content:a[0]+": "+a[2],placement:"right"}},[e("div",{staticClass:"line",style:{width:a[2],background:t.colors[n%t.colors.length],left:a[3]+"%"}})])]}))],2)])}))],2)},D=[],b=(e("7db0"),e("b64b"),e("159b"),e("fc7d")),y={props:{data:{type:Array}},data:function(){return{groupList:[],colors:b["a"].covidDataUtil.colorList}},mounted:function(){this.initGroup()},methods:{initGroup:function(){this.group(this.data)},group:function(t){if(!Array.isArray(t))return null;var a={sex:{label:"性别",value:""},address:{label:"位置",value:""},age:{label:"年龄",value:function(t){var a=b["a"].formatAge(t);if(a=parseInt(a),a){var e=b["a"].covidDataUtil.ageGroup1.find((function(t){return a>t.limit[0]&&a<=t.limit[1]}));return e.label}}}};this.groupList=Object.keys(a).map((function(e){var n=[],i=a[e].value;t.forEach((function(t){var a=t[e];if(a){var s=i?i(a):a;if(!s)return;var r=n.find((function(t){return t[0]===s}));r?r[1]+=1:n.push([s,1])}}));var s=0;return n.forEach((function(a){var e=Math.round(a[1]/t.length*100);a.push("".concat(e,"%")),a.push(s),s+=e})),{prop:e,group:n}})),console.log("分组",this.groupList)}}},g=y,C=(e("3d82"),e("2877")),_=Object(C["a"])(g,w,D,!1,null,"1c7cf78e",null),T=_.exports,L={components:{Details:T},props:{data:{type:Array}},data:function(){return{showDetail:!1}},computed:{count:function(){return this.data.length},date:function(){return this.count?this.data[0].date:""}},methods:{showDetailsHandle:function(){this.showDetail=!this.showDetail}}},k=L,x=(e("9a28"),Object(C["a"])(k,v,m,!1,null,"12c2be2c",null)),M=x.exports,R={components:{Map:c["a"],DistributionChart:function(){return Promise.all([e.e("chart"),e.e("chunk-vendors"),e.e("chunk-2294953c")]).then(e.bind(null,"50e8"))},TrendChart:function(){return Promise.all([e.e("chart"),e.e("chunk-vendors"),e.e("chunk-820cd1c8")]).then(e.bind(null,"4c63"))},TimeLine:function(){return e.e("chunk-1e000fd7").then(e.bind(null,"1bb3"))},Info:M},mixins:[p["a"]],data:function(){return{szyqData:null,heatlayer:null,mapCenter:[114.040504,22.553397],totalIndex:0,showChart:"",input:"",dateRange:"",showTimeLine:!1,covidDataDate:{start:f["a"].startDate,end:f["a"].endDate},searchResult:[],showSearchResult:!1}},computed:{totalType:function(){return this.totalTypeList[this.totalIndex]}},watch:{totalIndex:function(t){this.changeMapData(t)}},mounted:function(){this.getData()},methods:{getData:function(){var t=this;this.$api.getSzyzData().then((function(a){t.szyqData=a,t.$refs.map.mapObj&&t.showHeatmap(a)}))},showHeatmap:function(t){var a=this.$refs.map.mapObj;if(a){this.heatlayer&&a.getOlMap().removeLayer(this.heatlayer),this.heatlayer=this.createHeatmap(),a.getOlMap().addLayer(this.heatlayer);var e=t.map((function(t){var a=parseFloat(t.x,10),e=parseFloat(t.y,10);return new h["a"]({geometry:new d["a"]([a,e])})})),n=this.heatlayer.getSource();n.addFeatures(e)}},createHeatmap:function(){var t=new l["a"]({source:new u["a"],blur:7,radius:5,weight:function(){return 3}});return t},changeTotalType:function(){this.showTimeLine||(this.totalIndex=this.totalIndex>=this.totalTypeList.length-1?0:this.totalIndex+1)},changeMapData:function(t){var a,e,n=this.totalTypeList[this.totalIndex];if("custom"===n.code){var i=Object(s["a"])(this.dateRange,2);a=i[0],e=i[1]}else e=o()(f["a"].endDate),a=o()(f["a"].endDate).subtract(n.value,"day");this.updateDate(a,e)},showChartHandle:function(t){if(!this.showTimeLine){var a=0===t?"distributionChart":"trendChart";this.showChart===a?this.showChart="":this.showChart=a}},dataRangeChanged:function(){this.changeMapData()},showTimeLineHandle:function(){this.showTimeLine=!this.showTimeLine},handleDateChange:function(t){console.log("date",t,this.totalTypeList[this.totalIndex]),this.changeMapDateForTimeLine(t)},changeMapDateForTimeLine:function(t){var a=this.totalTypeList[this.totalIndex],e=a.value||1,n=t,i=o()(n).subtract(e,"day");this.updateDate(i,n)},updateDate:function(t,a){this.covidDataDate.end=o()(a).format("YYYY-MM-DD"),this.covidDataDate.start=o()(t).format("YYYY-MM-DD");var e=this.filterMapDataByDateRange(t,a,this.szyqData);this.showHeatmap(e)},searchHandle:function(){if(this.searchResult=[],!this.input)return"";this.showSearchResult=!0;var t=this.formatDate(this.input),a=this.szyqData.filter((function(a){return a.date===t}));this.searchResult=a},formatDate:function(t){var a="YYYY-MM-DD",e=t.replace("-");return o()(e).format(a)}}},H=R,z=(e("eaf6"),Object(C["a"])(H,n,i,!1,null,"73ce582b",null));a["default"]=z.exports},"27cd":function(t,a,e){},"333f":function(t,a,e){"use strict";a["a"]={startDate:"2022-03-01",endDate:"2022-03-31"}},"343d":function(t,a,e){"use strict";e("4de4"),e("d3b7");var n=e("c1df"),i=e.n(n),s=e("333f");a["a"]={data:function(){return{personCategory:[{code:"age",label:"按年龄"},{code:"sex",label:"按性别"},{code:"area",label:"按区域"}],totalTypeList:[{code:"day",label:"昨日数据",value:1},{code:"day3",label:"三日累计",value:3},{code:"day7",label:"七日累计",value:7},{code:"day15",label:"十五日累计",value:15},{code:"custom",label:"自定义时间范围",value:0}]}},methods:{filterMapDataBySubDate:function(t,a){if(Array.isArray(a)){var e=i()(s["a"].endDate).subtract(t,"day"),n=a.filter((function(t){var a=i()(t.date);return a.isAfter(e)}));return n}},filterMapDataByDateRange:function(t,a,e){var n=i()(t).subtract(1,"day"),s=i()(a),r=e.filter((function(t){var a=i()(t.date);return a.isBetween(n,s)}));return r}}}},"3d82":function(t,a,e){"use strict";e("9f5a")},"9a28":function(t,a,e){"use strict";e("fd1b")},"9f5a":function(t,a,e){},a0be:function(t,a,e){"use strict";var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"map"}})},i=[],s=(e("a9e3"),e("557c")),r={props:{center:{type:Array,default:function(){return[112,32]}},zoom:{type:Number,default:12}},data:function(){return{mapObj:void 0}},mounted:function(){this.init()},methods:{init:function(){this.mapObj=new s["a"]({target:"map",center:this.center,zoom:this.zoom})}}},o=r,c=(e("c01d"),e("2877")),l=Object(c["a"])(o,n,i,!1,null,"34e941a7",null);a["a"]=l.exports},c01d:function(t,a,e){"use strict";e("c240")},c240:function(t,a,e){},eaf6:function(t,a,e){"use strict";e("27cd")},fd1b:function(t,a,e){}}]);